<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>3D tisk – cenová kalkulačka</title>
  <style>
    :root{--bg:#f7f7fb;--card:#ffffff;--ink:#1f2937;--muted:#6b7280;--line:#e5e7eb;--primary:#111827}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .wrap{max-width:1100px;margin:auto;padding:24px}
    h1{font-size:28px;margin:0 0 16px}
    .grid{display:grid;gap:16px}
    @media(min-width:860px){.grid-2{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.04);}
    .card-h{padding:14px 16px;border-bottom:1px solid var(--line);font-weight:600}
    .card-c{padding:16px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;color:var(--ink)}
    input[type=range]{padding:0}
    .switch{display:flex;align-items:center;gap:8px;margin:8px 0}
    .pill{border:1px solid var(--line);background:#fff;border-radius:14px;padding:8px 12px;display:inline-flex;gap:8px;align-items:center}
    .stats{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .stat{background:#fff;border:1px solid var(--line);border-radius:16px;padding:14px}
    .stat small{display:block;color:var(--muted)}
    .stat b{font-size:22px}
    .btns{display:flex;gap:10px;margin-top:10px}
    button{appearance:none;border-radius:12px;padding:10px 14px;border:1px solid var(--line);background:#fff;cursor:pointer}
    button.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
    .muted{color:var(--muted)}
    .note{font-size:13px;color:var(--muted)}
    ul{margin:0;padding-left:18px}
    .value{font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>3D tisk – cenová kalkulačka</h1>

    <div class="card">
      <div class="card-h">Vstupy</div>
      <div class="card-c grid grid-2">
        <div class="grid" style="gap:12px">
          <div>
            <label for="pricePerKg">Cena filamentu (Kč/kg)</label>
            <input id="pricePerKg" type="number" step="0.01" value="274.5" />
          </div>

          <div class="row">
            <div>
              <label for="timeH">Doba tisku – hodiny</label>
              <input id="timeH" type="number" step="1" value="0" />
            </div>
            <div>
              <label for="timeM">Doba tisku – minuty</label>
              <input id="timeM" type="number" step="1" value="0" />
            </div>
          </div>

          <div class="switch">
            <input type="checkbox" id="useMeters" />
            <label for="useMeters" style="margin:0">Zadat délku (m) místo hmotnosti (g)</label>
          </div>

          <div id="gramsWrap">
            <label for="grams">Spotřeba materiálu (g)</label>
            <input id="grams" type="number" step="0.01" value="0" />
          </div>

          <div id="metersWrap" style="display:none">
            <div style="margin-bottom:8px">
              <label for="meters">Délka filamentu (m)</label>
              <input id="meters" type="number" step="0.01" value="0" />
            </div>
            <div class="row">
              <div>
                <label for="diameter">Průměr filamentu</label>
                <select id="diameter">
                  <option value="1.75" selected>1.75 mm</option>
                  <option value="2.85">2.85 mm</option>
                </select>
              </div>
              <div>
                <label for="density">Hustota materiálu</label>
                <select id="density">
                  <option value="1.24" selected>PLA (1,24 g/cm³)</option>
                  <option value="1.05">PETG (1,05 g/cm³)</option>
                  <option value="1.20">ABS/ASA (1,20 g/cm³)</option>
                  <option value="1.00">Vlastní (1,00 g/cm³)</option>
                </select>
              </div>
            </div>
            <div class="note">Vypočtená hmotnost: <span id="gramsFromMeters" class="value">0</span> g</div>
          </div>
        </div>

        <div class="grid" style="gap:12px">
          <div class="row">
            <div>
              <label for="powerW">Výkon tiskárny (W)</label>
              <input id="powerW" type="number" step="1" value="100" />
            </div>
            <div>
              <label for="kwhPrice">Cena elektřiny (Kč/kWh)</label>
              <input id="kwhPrice" type="number" step="0.01" value="5" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="machineRate">Strojní čas (Kč/h)</label>
              <input id="machineRate" type="number" step="0.5" value="20" />
            </div>
            <div>
              <label for="setupFee">Paušál obsluhy (Kč)</label>
              <input id="setupFee" type="number" step="1" value="15" />
            </div>
          </div>

          <div>
            <label for="margin">Marže: <span id="marginVal" class="value">50</span>%</label>
            <input id="margin" type="range" min="0" max="200" step="1" value="50" />
          </div>

          <div class="btns">
            <button id="reset">Reset</button>
            <button id="fillDemo" class="primary" title="Vyplnit ukázková data">Demo</button>
          </div>
        </div>
      </div>
    </div>

    <div class="grid grid-2" style="margin-top:16px">
      <div class="card">
        <div class="card-h">Výsledky</div>
        <div class="card-c grid" style="gap:12px">
          <div class="pill">
            Čas: <span id="hours" class="value">0</span> h • Hmotnost: <span id="totalGrams" class="value">0</span> g • El.: <span id="electricityKwh" class="value">0</span> kWh
          </div>
          <div class="stats">
            <div class="stat"><small>Materiál</small><b id="materialCost">0 Kč</b></div>
            <div class="stat"><small>Elektřina</small><b id="electricityCost">0 Kč</b></div>
            <div class="stat"><small>Přímý náklad</small><b id="directCost">0 Kč</b></div>
            <div class="stat"><small>Podnikový náklad</small><b id="businessCost">0 Kč</b></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-h">Prodejní cena</div>
        <div class="card-c grid" style="gap:12px">
          <div class="stat"><small>Doporučená cena (s marží)</small><b id="priceWithMargin" style="font-size:28px">0 Kč</b></div>
          <div class="stats">
            <div class="stat"><small>+30 %</small><b id="p30">0 Kč</b></div>
            <div class="stat"><small>+50 %</small><b id="p50">0 Kč</b></div>
            <div class="stat"><small>+100 %</small><b id="p100">0 Kč</b></div>
          </div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="card-h">Jak se počítá</div>
      <div class="card-c">
        <ul class="note">
          <li>Materiál = (Cena/kg ÷ 1000) × hmotnost(g)</li>
          <li>Hmotnost z délky = π·(d/2)^2 × 100 × hustota (g/cm³) × délka(m) (s převody na cm)</li>
          <li>Elektřina = (Výkon W ÷ 1000) × čas(h) × cena (Kč/kWh)</li>
          <li>Přímý náklad = Materiál + Elektřina</li>
          <li>Podnikový náklad = Přímý náklad + (Strojní čas × hodiny) + Paušál</li>
          <li>Prodejní cena = Podnikový náklad × (1 + marže)</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const nfmt = new Intl.NumberFormat('cs-CZ', { maximumFractionDigits: 2 });
    const kfmt = (n) => `${nfmt.format(isFinite(n) ? n : 0)} Kč`;

    function metersToGrams(meters, diameterMm, densityGcm3){
      const r_cm = (diameterMm/2)/10; // mm -> cm
      const area_cm2 = Math.PI * r_cm * r_cm;
      const length_cm = meters * 100;
      const volume_cm3 = area_cm2 * length_cm;
      return volume_cm3 * densityGcm3; // g
    }

    function val(id){
      const el = $(id);
      const v = parseFloat(el.value);
      return isFinite(v) ? v : 0;
    }

    function compute(){
      const pricePerKg = val('pricePerKg');
      const timeH = val('timeH');
      const timeM = val('timeM');
      const useMeters = $('useMeters').checked;
      const grams = val('grams');
      const meters = val('meters');
      const diameter = val('diameter');
      const density = val('density');
      const powerW = val('powerW');
      const kwhPrice = val('kwhPrice');
      const machineRate = val('machineRate');
      const setupFee = val('setupFee');
      const marginPct = val('margin');

      const hours = timeH + timeM/60;
      const gramsFromMeters = useMeters ? metersToGrams(meters, diameter, density) : 0;
      const totalGrams = useMeters ? gramsFromMeters : grams;

      const materialCost = (pricePerKg/1000) * totalGrams;
      const electricityKwh = (powerW/1000) * hours;
      const electricityCost = electricityKwh * kwhPrice;
      const directCost = materialCost + electricityCost;
      const businessCost = directCost + machineRate * hours + setupFee;
      const priceWithMargin = businessCost * (1 + marginPct/100);

      $('hours').textContent = nfmt.format(hours);
      $('gramsFromMeters').textContent = nfmt.format(gramsFromMeters);
      $('totalGrams').textContent = nfmt.format(totalGrams);
      $('electricityKwh').textContent = nfmt.format(electricityKwh);

      $('materialCost').textContent = kfmt(materialCost);
      $('electricityCost').textContent = kfmt(electricityCost);
      $('directCost').textContent = kfmt(directCost);
      $('businessCost').textContent = kfmt(businessCost);
      $('priceWithMargin').textContent = kfmt(priceWithMargin);
      $('p30').textContent = kfmt(businessCost * 1.30);
      $('p50').textContent = kfmt(businessCost * 1.50);
      $('p100').textContent = kfmt(businessCost * 2.00);

      $('marginVal').textContent = nfmt.format(marginPct);
    }

    function toggleMode(){
      const on = $('useMeters').checked;
      $('gramsWrap').style.display = on ? 'none' : 'block';
      $('metersWrap').style.display = on ? 'block' : 'none';
      compute();
    }

    // wire events
    ['pricePerKg','timeH','timeM','grams','meters','diameter','density','powerW','kwhPrice','machineRate','setupFee','margin']
      .forEach(id => $(id).addEventListener('input', compute));
    $('useMeters').addEventListener('change', toggleMode);

    $('reset').addEventListener('click', () => {
      ['pricePerKg','timeH','timeM','grams','meters','powerW','kwhPrice','machineRate','setupFee','margin']
        .forEach((id,i) => {
          const el = $(id);
          const defaults = {pricePerKg:274.5,timeH:0,timeM:0,grams:0,meters:0,powerW:100,kwhPrice:5,machineRate:20,setupFee:15,margin:50};
          el.value = defaults[id];
        });
      $('diameter').value = '1.75';
      $('density').value = '1.24';
      $('useMeters').checked = false;
      toggleMode();
    });

    $('fillDemo').addEventListener('click', () => {
      $('pricePerKg').value = 274.5;
      $('timeH').value = 2; $('timeM').value = 15;
      $('grams').value = 17.26;
      $('useMeters').checked = false;
      $('powerW').value = 100; $('kwhPrice').value = 5;
      $('machineRate').value = 20; $('setupFee').value = 15; $('margin').value = 50;
      toggleMode();
    });

    // initial render
    compute();
  </script>
</body>
</html>
