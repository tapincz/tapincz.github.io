<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Přihlášení</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen">
    <div id="login-container" class="w-full max-w-md p-8 bg-gray-800 rounded-lg shadow-lg">
        <h1 class="text-2xl font-bold text-blue-400 text-center mb-6">Přihlášení</h1>
        <div class="space-y-4">
            <input id="email" type="email" placeholder="Email" class="w-full p-3 bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600">
            <input id="password" type="password" placeholder="Heslo" class="w-full p-3 bg-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600">
            <label class="flex items-center space-x-2">
                <input id="remember" type="checkbox" class="h-4 w-4 text-blue-600">
                <span class="text-gray-300">Zapamatovat na týden</span>
            </label>
            <button id="login-btn" class="w-full p-3 bg-blue-600 rounded-lg hover:bg-blue-700 transition">Přihlásit se</button>
            <p id="error-message" class="text-red-500 text-center hidden"></p>
        </div>
    </div>
    <div id="dashboard-container" class="w-full max-w-md p-8 bg-gray-800 rounded-lg shadow-lg hidden">
        <h1 class="text-2xl font-bold text-blue-400 text-center mb-6">Dashboard</h1>
        <div class="space-y-4">
            <a href="cenik.html" class="block p-3 bg-blue-600 rounded-lg text-center hover:bg-blue-700 transition">Ceník</a>
            <a href="mapa.html" class="block p-3 bg-blue-600 rounded-lg text-center hover:bg-blue-700 transition">Mapa</a>
            <button id="logout-btn" class="w-full p-3 bg-red-600 rounded-lg hover:bg-red-700 transition">Odhlásit se</button>
        </div>
    </div>
    <script src="auth.js"></script>
    <script>
        const supabase = initializeSupabase();
        
        // Check if user is already logged in
        supabase.auth.getSession().then(({ data: { session } }) => {
            if (session) {
                document.getElementById('login-container').classList.add('hidden');
                document.getElementById('dashboard-container').classList.remove('hidden');
            }
        });

        // Handle login
        document.getElementById('login-btn').addEventListener('click', async () => {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const remember = document.getElementById('remember').checked;
            const errorMessage = document.getElementById('error-message');

            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password
            });

            if (error) {
                errorMessage.textContent = 'Chyba přihlášení: ' + error.message;
                errorMessage.classList.remove('hidden');
                return;
            }

            if (remember) {
                localStorage.setItem('supabase_session', JSON.stringify(data.session));
                const expiresAt = new Date(data.session.expires_at * 1000);
                const oneWeek = new Date();
                oneWeek.setDate(oneWeek.getDate() + 7);
                if (expiresAt > oneWeek) {
                    data.session.expires_at = Math.floor(oneWeek.getTime() / 1000);
                }
            }

            document.getElementById('login-container').classList.add('hidden');
            document.getElementById('dashboard-container').classList.remove('hidden');
        });

        // Handle logout
        document.getElementById('logout-btn').addEventListener('click', async () => {
            await supabase.auth.signOut();
            localStorage.removeItem('supabase_session');
            document.getElementById('dashboard-container').classList.add('hidden');
            document.getElementById('login-container').classList.remove('hidden');
        });
    </script>
</body>
</html>
